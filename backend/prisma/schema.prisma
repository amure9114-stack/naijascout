generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url = env("DATABASE_URL")
}

// Role enum removed for SQLite compatibility; use string role instead

model User {
  id          Int      @id @default(autoincrement())
  name        String
  username    String   @unique
  email       String   @unique
  passwordHash String  @map("passwordHash")
  role        String   @default("player")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Shortlist {
  id        Int      @id @default(autoincrement())
  scoutId   Int      @map("scout_id")
  playerId  Int      @map("player_id")
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")

  scout  Scout  @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([scoutId, playerId])
  @@map("shortlist")
}

model Player {
  id             Int      @id @default(autoincrement())
  username       String   @unique
  firstName      String
  lastName       String
  position       String
  club           String
  age            Int
  nationality    String
  overallRating  Int
  potential      Int
  profilePicture String?
  marketValue    Float    @default(0.0)
  demandScore    Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  matches              Match[]
  shortlists          Shortlist[]
  trialApplications   TrialApplication[]
  injuries            Injury[]
  sponsorshipApplications SponsorshipApplication[]
  tournamentRegistrations TournamentRegistration[]

  @@index([overallRating])
  @@index([age])
  @@map("Player")
}

model Scout {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  club      String?
  role      String   @default("Scout")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shortlists Shortlist[]

  @@map("Scout")
}


model Match {
  id        Int      @id @default(autoincrement())
  playerId  Int
  opponent  String
  date      DateTime
  rating    Float
  goals     Int
  assists   Int
  result    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("Match")
}

model Trial {
  id          Int      @id @default(autoincrement())
  title       String
  location    String
  ageGroup    String?
  time        String?
  description String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  applications TrialApplication[]

  @@map("Trials")
}

model TrialApplication {
  id        Int      @id @default(autoincrement())
  trialId  Int
  playerId Int
  status   String   @default("pending") // pending, approved, rejected
  notes    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trial  Trial  @relation(fields: [trialId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([trialId, playerId])
  @@map("TrialApplication")
}

model Injury {
  id              Int      @id @default(autoincrement())
  playerId        Int
  injuryType      String
  bodyPart        String
  severity        String   // mild, moderate, severe
  status          String   // active, recovering, recovered
  dateInjured      DateTime
  expectedRecovery DateTime?
  actualRecovery   DateTime?
  description      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("Injury")
}

model Sponsorship {
  id          Int      @id @default(autoincrement())
  name        String
  type        String   // corporate, foundation, nonprofit, individual
  amount      String   // e.g., "₦300,000 - ₦800,000"
  period      String   // per year, per month, etc.
  location    String
  focus       String
  description String?
  requirements String? // JSON string or text
  benefits    String?  // JSON string or text
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  applications SponsorshipApplication[]

  @@map("Sponsorship")
}

model SponsorshipApplication {
  id              Int      @id @default(autoincrement())
  sponsorshipId   Int
  playerId        Int
  status          String   @default("pending") // pending, approved, rejected
  fullName        String
  email           String
  phone           String
  location        String
  position        String
  experience      String
  achievements    String?
  goals           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  sponsorship Sponsorship @relation(fields: [sponsorshipId], references: [id], onDelete: Cascade)
  player      Player      @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("SponsorshipApplication")
}

model Tournament {
  id          Int      @id @default(autoincrement())
  name        String
  location    String
  startDate  DateTime
  endDate     DateTime?
  description String?
  category    String?  // youth, professional, amateur, etc.
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  registrations TournamentRegistration[]

  @@map("Tournament")
}

model TournamentRegistration {
  id          Int      @id @default(autoincrement())
  tournamentId Int
  playerId    Int
  status      String   @default("registered") // registered, confirmed, cancelled
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  player     Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, playerId])
  @@map("TournamentRegistration")
}