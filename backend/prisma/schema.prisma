generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
}

// Role enum removed for SQLite compatibility; use string role instead

model User {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  username    String   @unique
  email       String   @unique
  passwordHash String  @map("passwordHash")
  role        String   @default("player")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Shortlist {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  scoutId   String   @map("scout_id") @db.ObjectId
  playerId  String   @map("player_id") @db.ObjectId
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")

  scout  Scout  @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([scoutId, playerId])
  @@map("shortlist")
}

model Player {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  username       String   @unique
  firstName      String
  lastName       String
  position       String
  club           String
  age            Int
  nationality    String
  overallRating  Int
  potential      Int
  profilePicture String?
  marketValue    Float    @default(0.0)
  demandScore    Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  matches              Match[]
  shortlists          Shortlist[]
  trialApplications   TrialApplication[]
  injuries            Injury[]
  sponsorshipApplications SponsorshipApplication[]
  tournamentRegistrations TournamentRegistration[]
  scoutingReports     ScoutingReport[]

  @@index([overallRating])
  @@index([age])
  @@map("Player")
}

model Scout {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  password  String
  club      String?
  role      String   @default("Scout")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shortlists Shortlist[]
  reports    ScoutingReport[]

  @@map("Scout")
}

model ScoutingReport {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  scoutId   String   @map("scout_id") @db.ObjectId
  playerId  String   @map("player_id") @db.ObjectId
  summary   String
  rating    Float?
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  scout  Scout   @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player Player  @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("scouting_report")
}


model Match {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  playerId  String   @db.ObjectId
  opponent  String
  date      DateTime
  rating    Float
  goals     Int
  assists   Int
  result    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("Match")
}

model Trial {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  location    String
  ageGroup    String?
  time        String?
  description String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  applications TrialApplication[]

  @@map("Trials")
}

model TrialApplication {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  trialId   String   @db.ObjectId
  playerId  String   @db.ObjectId
  status    String   @default("pending")
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trial  Trial  @relation(fields: [trialId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([trialId, playerId])
  @@map("TrialApplication")
}

model Injury {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  playerId        String   @db.ObjectId
  injuryType      String
  bodyPart        String
  severity        String
  status          String
  dateInjured      DateTime
  expectedRecovery DateTime?
  actualRecovery   DateTime?
  description      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("Injury")
}

model Sponsorship {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  type        String
  amount      String
  period      String
  location    String
  focus       String
  description String?
  requirements String?
  benefits    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  applications SponsorshipApplication[]

  @@map("Sponsorship")
}

model SponsorshipApplication {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  sponsorshipId   String   @db.ObjectId
  playerId        String   @db.ObjectId
  status          String   @default("pending")
  fullName        String
  email           String
  phone           String
  location        String
  position        String
  experience      String
  achievements    String?
  goals           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  sponsorship Sponsorship @relation(fields: [sponsorshipId], references: [id], onDelete: Cascade)
  player      Player      @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("SponsorshipApplication")
}

model Tournament {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  location    String
  startDate  DateTime
  endDate     DateTime?
  description String?
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  registrations TournamentRegistration[]

  @@map("Tournament")
}

model TournamentRegistration {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  tournamentId String   @db.ObjectId
  playerId    String   @db.ObjectId
  status      String   @default("registered")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  player     Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, playerId])
  @@map("TournamentRegistration")
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  type      String   // e.g., "trial_update", "message", "follow", "shortlist"
  title     String
  message   String
  relatedId String?  @db.ObjectId
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Notification")
}

model Message {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  senderId   String   @db.ObjectId
  receiverId String   @db.ObjectId
  text       String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([senderId])
  @@index([receiverId])
  @@map("Message")
}

model Follow {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  followerId String   @db.ObjectId
  followeeId String   @db.ObjectId
  createdAt  DateTime @default(now())

  @@unique([followerId, followeeId])
  @@map("Follow")
}